FROM python:3.11-alpine3.17 as default

ENV PYTHONUNBUFFERED 1
ENV PYTHONDONTWRITEBYTECODE 1
WORKDIR /seaside/algae

COPY requirements.txt ./
RUN pip install -r requirements.txt

COPY sources/*.py ./

ENV COMMAND true
ENV LOG_LEVEL DEBUG

ENV VPN True
ENV TUNNEL seatun
ENV CONN_MTU 1500
ENV CONN_BUFF 2000
ENV ADDRESS 127.0.0.1
ENV IN_PORT 1724
ENV OUT_PORT 1723
ENV CTRL_PORT 1725

EXPOSE $IN_PORT
ENTRYPOINT (python3 main.py -t $TUNNEL -e $VPN -m $CONN_MTU -b $CONN_BUFF -a $ADDRESS -i $IN_PORT -o $OUT_PORT &) && sh -c "$COMMAND"
