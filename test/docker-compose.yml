version: '3.1'

services:
  vpnserver:
    privileged: true
    build:
      context: ../caerulean/whirlpool
      dockerfile: Dockerfile
    environment:
      ADDRESS: 10.0.0.87
    networks:
      default:
        ipv4_address: 10.0.0.87

  vpnclient:
    privileged: true
    build:
      context: ../viridian/algae
      dockerfile: Dockerfile
    environment:
      ADDRESS: 10.0.0.87
      COMMAND: sleep 3 && ping -c 16 -s 64 8.8.8.8
    networks:
      default:
        ipv4_address: 10.0.0.65
    depends_on:
      - vpnserver

  vpntester:
    privileged: true
    image: alpine:3.17
    command: ping -c 16 -s 64 8.8.8.8
    networks:
      default:
        ipv4_address: 10.0.0.5
    depends_on:
      - vpnserver

networks:
  default:
    driver: bridge
    ipam:
     config:
       - subnet: 10.0.0.0/24
         gateway: 10.0.0.1
